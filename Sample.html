<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Task Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f8f8f8;
    }
    h1 {
        text-align: center;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        vertical-align: top;
    }
    th {
        background-color: #eee;
    }
    textarea {
        width: 95%;
        height: 50px;
        resize: vertical;
    }
    .remark {
        background-color: #ffffcc;
    }
    .status-box {
        width: 30px;
        height: 30px;
        cursor: pointer;
        display: inline-block;
        border: 1px solid #888;
    }
    #character {
        display: block;
        margin: 20px auto;
        max-width: 150px;
    }
</style>
</head>
<body>

<h1>Daily Task Tracker</h1>
<img id="character" src="stage1.png" alt="Progress Character">

<table id="taskTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Task</th>
            <th>Progress</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
// Configuration
const startDate = new Date(2025, 7, 13); // Aug 13, 2025 (month index is 0-based)
const endDate = new Date(2026, 1, 1); // Feb 1, 2026
const savedData = JSON.parse(localStorage.getItem('tasks') || '{}');

// Generate table rows
let tbody = document.querySelector("#taskTable tbody");
let dayCount = 0;
for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
    dayCount++;
    // Remark row for Sundays
    if(d.getDay() === 0){
        let row = tbody.insertRow();
        row.classList.add("remark");
        row.insertCell().textContent = "Remark:";
        let remarkBox = document.createElement("textarea");
        remarkBox.value = savedData[`remark-${dayCount}`] || "";
        remarkBox.oninput = () => {
            savedData[`remark-${dayCount}`] = remarkBox.value;
            localStorage.setItem('tasks', JSON.stringify(savedData));
        };
        row.insertCell().appendChild(remarkBox);
        row.insertCell();
        row.insertCell();
    }
    // Task row
    let tr = tbody.insertRow();
    tr.insertCell().textContent = d.toLocaleDateString();
    
    let task = document.createElement("textarea");
    task.value = savedData[`task-${dayCount}`] || "";
    task.oninput = () => {
        savedData[`task-${dayCount}`] = task.value;
        localStorage.setItem('tasks', JSON.stringify(savedData));
    };
    tr.insertCell().appendChild(task);

    let prog = document.createElement("textarea");
    prog.value = savedData[`prog-${dayCount}`] || "";
    prog.oninput = () => {
        savedData[`prog-${dayCount}`] = prog.value;
        localStorage.setItem('tasks', JSON.stringify(savedData));
    };
    tr.insertCell().appendChild(prog);

    let statusBox = document.createElement("div");
    statusBox.className = "status-box";
    statusBox.style.backgroundColor = savedData[`status-${dayCount}`] || "white";
    statusBox.onclick = () => {
        let color = prompt("Enter status color (green, red, yellow, etc.)", statusBox.style.backgroundColor);
        if(color) {
            statusBox.style.backgroundColor = color.toLowerCase();
            savedData[`status-${dayCount}`] = color.toLowerCase();
            localStorage.setItem('tasks', JSON.stringify(savedData));
            updateCharacter();
        }
    };
    tr.insertCell().appendChild(statusBox);
}

// Update character based on success ratio
function updateCharacter(){
    let totalDays = 0, greenDays = 0;
    for(let key in savedData){
        if(key.startsWith("status-")){
            totalDays++;
            if(savedData[key].toLowerCase() === "green"){
                greenDays++;
            }
        }
    }
    let ratio = totalDays > 0 ? greenDays / totalDays : 0;
    let charImg = document.getElementById("character");
    if(ratio === 1){
        charImg.src = "stage5.png";
    } else if(ratio > 0.75){
        charImg.src = "stage4.png";
    } else if(ratio > 0.5){
        charImg.src = "stage3.png";
    } else if(ratio > 0.25){
        charImg.src = "stage2.png";
    } else {
        charImg.src = "stage1.png";
    }
}

// Initialize
updateCharacter();
</script>

</body>
</html>
